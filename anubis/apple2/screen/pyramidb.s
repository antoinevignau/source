*
* Le secret d'Anubis
*
* (c) 2025, Eric Cubizolle (TITAN)
* (c) 2025, Brutal Deluxe Software
*

	ext	PYRAMIDB_str100
	ext	PYRAMIDB_str200
	ext	PYRAMIDB_str300
	ext	PYRAMIDB_str400
	ext	PYRAMIDB_str500
	ext	PYRAMIDB_str600
	ext	PYRAMIDB_str700
	ext	PYRAMIDB_str880
	ext	PYRAMIDB_str890
	ext	PYRAMIDB_str1400
	ext	PYRAMIDB_str1500
	ext	PYRAMIDB_str1600

PYRAMIDB	@LOAD	#pPYRAMIDB
PYRAMIDB_60	@SHOWPIC

	@WINDOW	#1;#theWINDOW1
	@PRINT	#1;PYRAMIDB_str100
	@PRINT	#0;PYRAMIDB_str200

PYRAMIDB_LOOP	@INKEY
	@DEBUG
	cmp	#'1'
	bne	PYRAMIDB_200
	jmp	PYRAMIDA
PYRAMIDB_200	cmp	#'2'
	bne	PYRAMIDB_210
	jmp	PYRAMID7
PYRAMIDB_210	cmp	#'3'
	bne	PYRAMIDB_220
	jmp	PYRAMIDB_300
PYRAMIDB_220	cmp	#'4'
	bne	PYRAMIDB_230
	jmp	PYRAMIDB_400
PYRAMIDB_230	cmp	#'5'
	bne	PYRAMIDB_240
	jmp	PYRAMIDB_500
PYRAMIDB_240	cmp	#'6'
	bne	PYRAMIDB_250
	jmp	PYRAMIDB_600
PYRAMIDB_250	cmp	#'7'
	bne	PYRAMIDB_LOOP	

	lda	PEEK_7005
	cmp	#FALSE
	beq	PYRAMIDB_700
	cmp	#TRUE
	bne	PYRAMIDB_LOOP
	jmp	PYRAMIDB_1600
	
*---

PYRAMIDB_300	@PRINT	#0;PYRAMIDB_str300
	@INKEY
	jmp	PYRAMIDB_60

PYRAMIDB_400	@PRINT	#0;PYRAMIDB_str400
	@INKEY
	jmp	PYRAMIDB_60

PYRAMIDB_500	@PRINT	#0;PYRAMIDB_str500
	@INKEY
	jmp	MORT

PYRAMIDB_600	@PRINT	#0;PYRAMIDB_str600
	@INKEY
	jmp	PYRAMIDB_60

*---

PYRAMIDB_700	@PRINT	#0;PYRAMIDB_str700
PYRAMIDB_770	@INKEY
	cmp	#chrYES
	beq	PYRAMIDB_800
	cmp	#chrNO
	bne	PYRAMIDB_770
	jmp	PYRAMIDB_60

PYRAMIDB_800	pha
	_Random
	pla
	and	#%00000000_00000111	; we want 1..7
	beq	PYRAMIDB_800
	sta	VAR_RANDOM
	
	@PRINT	#0;PYRAMIDB_str880
	
*	@PRINT	#0;STR_RANDOM
	lda	VAR_RANDOM
	asl
	tay
	lda	tblRANDOM,y
	tay
	ldx	#^tblRANDOM
	lda	#0
	jsr	PRINT

	@PRINT	#0;PYRAMIDB_str890
PYRAMIDB_1200	@INKEY
	cmp	#'1'
	bcc	PYRAMIDB_1200
	cmp	#'7'+1
	bcs	PYRAMIDB_1200
	sec
	sbc	#'0'
	cmp	VAR_RANDOM
	beq	PYRAMIDB_1500

PYRAMIDB_1400	@PRINT	#0;PYRAMIDB_str1400
	@INKEY
	jmp	PYRAMIDB_60

PYRAMIDB_1500	@PRINT	#0;PYRAMIDB_str1500
	@INKEY
	lda	#TRUE
	sta	PEEK_7005
	jmp	PYRAMIDB_60

PYRAMIDB_1600	@PRINT	#0;PYRAMIDB_str1600
	@INKEY
	jmp	PYRAMIDB_800

*---

pPYRAMIDB	strl	'@/data/pyramidb.lz4'

tblRANDOM	ds	2
	da	STR_RANDOM1
	da	STR_RANDOM2
	da	STR_RANDOM3
	da	STR_RANDOM4
	da	STR_RANDOM5
	da	STR_RANDOM6
	da	STR_RANDOM7

STR_RANDOM1	asc	'SOBEK'00	; Crocodile
STR_RANDOM2	asc	'THOT'00	; Ibis
STR_RANDOM3	asc	'HORUS'00	; Faucon
STR_RANDOM4	asc	'BASTET'00	; Chat
STR_RANDOM5	asc	'MIYSIS'00	; Lion
STR_RANDOM6	asc	'KHNOUM'00	; Belier
STR_RANDOM7	asc	'ANUBIS'00	; Chacal

VAR_RANDOM	ds	2
